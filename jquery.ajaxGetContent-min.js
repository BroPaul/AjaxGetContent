/*	
 *	jQuery AjaxGetContent 1.3

 *  Requires: jQuery BBQ, http://benalman.com/projects/jquery-bbq-plugin/
 *	
 *	More info at:
 *  www.implico.pl/lang-en/ajaxgetcontent_dynamic_ajax_website,7.html
 *	info@implico.pl
 *	
 *	Copyright (c) 2012 Implico Group
 *	www.implico.pl
 *
 *	Licensed under the MIT license.
 *	http://en.wikipedia.org/wiki/MIT_License
 */

(function(e){e.fn.ajaxGetContent=function(t){t=e.extend({requestParameter:"ajax_get_standard_content",baseUrl:"",useCache:true,forceBookmarkLinking:false,params:{},excludeAttr:{rel:"lightbox",rel:"nofollow"},onHrefCheck:function(e,t){return e.length==0||e.substr(e.length-1,1)=="/"||e.substr(e.length-5,5)==".html"},onElementCheck:function(e){return!e.hasClass("no-ajax-load")},onSend:function(e){},onReceive:function(e,t){}},t);var n=!t.forceBookmarkLinking&&history.pushState;if(!e("body").data("ajaxGetContent"))e.fn.ajaxGetContent.cache=new Array;var r=this;e.fn.ajaxGetContent.lastClickedElement=null;e.fn.ajaxGetContent.lastClickedUrl=null;e.fn.ajaxGetContent.ajaxHandler=null;wasLoaded=e("body").data("ajaxGetContent");var i=function(n,r){if(typeof n=="boolean"){if(e.fn.ajaxGetContent.ajaxHandler){e.fn.ajaxGetContent.ajaxHandler.abort();e.fn.ajaxGetContent.ajaxHandler=null}e.fn.ajaxGetContent.lastClickedUrl=r;if(t.useCache&&r in e.fn.ajaxGetContent.cache){t.onSend(r);i(e.fn.ajaxGetContent.cache[r],"success");return}var s=new Array;var o=new String;if(r.indexOf("?")>=0)o=r.substr(r.indexOf("?"));var u=e.deparam(o);e.each(u,function(e,t){s.push({name:e,value:t})});var a=e.fn.ajaxGetContent.lastClickedElement;var f=a&&a.data("options")?a.data("options"):t;e.each(f.params,function(t,n){if(a.is(t))e.each(n,function(e,t){s.push({name:e,value:t})})});t.onSend(r);s.push({name:t.requestParameter,value:"on"});e.fn.ajaxGetContent.ajaxHandler=e.ajax({url:r,data:s,type:"GET",success:i,error:i,context:this})}else{e.fn.ajaxGetContent.ajaxHandler=null;if(r=="success"){if(t.useCache&&e.fn.ajaxGetContent.lastClickedUrl){e.fn.ajaxGetContent.cache[e.fn.ajaxGetContent.lastClickedUrl]=n}}else{}t.onReceive(n,r)}};e.fn.ajaxGetContent.load=function(t){if(n){if(t==null)t=href.location;history.pushState({},"",t);e(window).trigger("popstate")}else{if(t==null)t=e.param.fragment();if(e.param.fragment()!=t)jQuery.bbq.pushState(t,2);else i(true,t)}};e.fn.ajaxGetContent.scrollTo=function(t,n){var r=e("html").scrollTop();if(!r)r=e("body").scrollTop();if(n||r>e(t).offset().top){e("html,body").animate({scrollTop:e(t).offset().top},500)}};e.fn.ajaxGetContent.getCurrentUrl=function(){if(n){var t=new String(location.href);var r=t.indexOf("//");r=r>=0?r+2:0;t=t.substr(t.indexOf("/",r));if(t.length==0)t="/";return t}else return e.param.fragment()};e.fn.ajaxGetContent.clearCache=function(){e.fn.ajaxGetContent.cache=new Array};if(!e("body").data("ajaxGetContent")){e(window).bind(n?"popstate":"hashchange",function(e){if(!(n&&!wasLoaded))i(true,n?location.href:e.fragment)});e("body").data("ajaxGetContent",true)}e(window).load(function(){setTimeout(function(){wasLoaded=true;if(!n&&e.param.fragment()!="")e(window).trigger("hashchange")},1)});return this.each(function(r,i){$this=e(i);var s=$this.data("ajaxGetContent");var o=$this.attr("href");var u=new String;var a=location.href.substr(0,5)!="http:";var f=new String((a?"https://":"http://")+window.location.hostname);if(o.indexOf(f)==0)o=o.substr(f.length);if(o.indexOf("?")>=0){u=o.substr(o.indexOf("?"));o=o.substr(0,o.indexOf("?"))}var l=$this.attr("target");var c=o.indexOf("#")>=0||typeof l!=="undefined"&&l!==false;var h=t.onHrefCheck(o,u);var p=t.onElementCheck($this);var d=false;e.each(t.excludeAttr,function(e,t){if($this.attr(e)&&$this.attr(e).indexOf(t)==0){d=true;return}});var v=$this.get(0).onclick!=null;if(!s&&!c&&h&&p&&!d&&!v){$this.data("ajaxGetContent",true);$this.click(function(r){if(r&&r.which&&r.which!=1)return true;var i=new String(window.location.href);if(i.indexOf("#")>=0)i=i.substr(0,i.indexOf("#"));if(!n){var s=t.baseUrl;if(s!=""){if(i!=s){location.href=s+"#"+o+u;return false}}}var a=e(this);a.data("options",t);e.fn.ajaxGetContent.lastClickedElement=a;if(n){history.pushState({},"",o+u);e(window).trigger("popstate")}else jQuery.bbq.pushState(o+u,2);return false})}})}})(jQuery)