/**

 *	jQuery AjaxGetContent 1.6

 *
 *
 *	Requires: jQuery BBQ, http://benalman.com/projects/jquery-bbq-plugin/
 *	
 *	Copyright (c) 2012 Implico Group
 *	www.implico.pl
 *
 *	Licensed under the MIT license.
 *	http://en.wikipedia.org/wiki/MIT_License
 *	
 *	@author Bartosz Sak <info@implico.pl>
 *
 *	More info at:
 *	@see http://www.implico.pl/en/ajaxgetcontent-dynamic-ajax-website,7
 *	
 */


(function(e){e.fn.ajaxGetContent=function(t){t=e.extend(true,{requestParameter:"ajax_get_standard_content",baseUrl:"",useCache:true,forceBookmarkLinking:false,params:{},excludeAttr:{rel:"lightbox",rel:"nofollow"},onHrefCheck:function(e,t){return e.length>0&&(e.indexOf(".")<0||e.substr(e.length-5,5)==".html"||e.substr(e.length-4,4)==".php")},onElementCheck:function(e){return!e.hasClass("no-ajax-load")&&e.attr("rel")!="nofollow"},formsGet:{'form[method="get"]':function(){return true}},formsPost:null,effect:{type:null,target:"body",insertHead:false,insertTitle:true,timeoutBefore:300,timeoutAfter:300,callbackBeforePreAnimation:null,callbackBeforePostAnimation:null,callbackAfterPreAnimation:null,callbackAfterPostAnimation:null,loadScripts:true},onSend:function(n){if(e.fn.ajaxGetContent.lastClickedElement){e.fn.ajaxGetContent.scrollTo(0,true,t.effect.timeoutBefore)}if(e.fn.ajaxGetContent.animationDeferred){e.fn.ajaxGetContent.animationDeferred.cancelled=true;t.effect.target.stop("ajaxGetContent")}if(t.effect.callbackBeforePreAnimation)t.effect.callbackBeforePreAnimation();e.fn.ajaxGetContent.animationDeferred=new e.Deferred(function(n){n.cancelled=false;var r;if(t.effect.type=="fade"){r=t.effect.target.stop("ajaxGetContent").animate({opacity:.2},{duration:t.effect.timeoutBefore,queue:"ajaxGetContent"}).promise();t.effect.target.dequeue("ajaxGetContent")}else r=(new e.Deferred).resolve();e.when(r).then(function(){if(n.cancelled)n.reject();else{n.resolve();if(t.effect.callbackBeforePostAnimation)t.effect.callbackBeforePostAnimation()}})})},onReceive:function(n,r,i){e.when(e.fn.ajaxGetContent.animationDeferred).then(function(){n=r=="success"?n:n.responseText;if(!n)return;if(t.effect.insertHead||t.effect.insertTitle){dataHead=n.replace(/\<\!doctype[.\s\S]*\<head((\s[^\>]*\>)|(\>))/im,"").replace(/\<\/head\>[.\s\S]*/,"");if(dataHead){if(t.effect.insertHead)e("head").html(dataHead);else{var i=/\<title\>([^\<]*)/.exec(dataHead);if(i[1])e("head title").text(i[1])}}}n=n.replace(/\<\!doctype[.\s\S]*\<\/head\>/im,"").replace(/\<\/html\>/im,"").replace(/\<body[^\>]*\>/im,"").replace(/\<\/body\>/im,"");n=n;n=e(e.parseHTML(n,document,t.effect.loadScripts));var s=e("body");s.data("ajaxGetContent",null);s.html(n);if(!t.effect.loadScripts)e("a").ajaxGetContent(t);if(window._gaq)_gaq.push(["_trackPageview",e.fn.ajaxGetContent.getCurrentUrl()]);if(t.effect.callbackAfterPreAnimation)t.effect.callbackAfterPreAnimation();e.fn.ajaxGetContent.animationDeferred=new e.Deferred(function(n){n.cancelled=false;var r;if(t.effect.type=="fade"){r=t.effect.target.stop("ajaxGetContent").animate({opacity:1},{duration:t.effect.timeoutAfter,queue:"ajaxGetContent"}).promise();t.effect.target.dequeue("ajaxGetContent")}else r=(new e.Deferred).resolve();e.when(r).then(function(){if(n.cancelled)n.reject();else n.resolve()})});e.fn.ajaxGetContent.animationDeferred.done(function(){e.fn.ajaxGetContent.animationDeferred=null;if(t.effect.callbackAfterPostAnimation)t.effect.callbackAfterPostAnimation()})})}},t);if(typeof t.effect.target!="object")t.effect.target=e(t.effect.target);if(!e("body").data("ajaxGetContent")){var n=navigator.userAgent.toLowerCase().indexOf("android")>-1;e.fn.ajaxGetContent.usePushState=Boolean(!t.forceBookmarkLinking&&history.pushState&&!n)}if(!e("body").data("ajaxGetContent"))e.fn.ajaxGetContent.cache=new Array;var r=this;e.fn.ajaxGetContent.lastClickedElement=null;e.fn.ajaxGetContent.lastClickedUrl=null;e.fn.ajaxGetContent.ajaxHandler=null;e.fn.ajaxGetContent.history=e.fn.ajaxGetContent.history||[];e.fn.ajaxGetContent.animationDeferred=e.fn.ajaxGetContent.animationDeferred||null;wasLoaded=true;var i=function(n,r,s){if(typeof n=="boolean"){if(e.fn.ajaxGetContent.ajaxHandler){e.fn.ajaxGetContent.ajaxHandler.abort();e.fn.ajaxGetContent.ajaxHandler=null}e.fn.ajaxGetContent.lastClickedUrl=r;e.fn.ajaxGetContent.lastUrl=e.fn.ajaxGetContent.getCurrentUrl();e.fn.ajaxGetContent.lastFullUrl=e.fn.ajaxGetContent.getCurrentUrl(true);if(t.useCache&&r in e.fn.ajaxGetContent.cache){t.onSend(r);i(e.fn.ajaxGetContent.cache[r],"success",true);return}var o=new Array;var u=new String;var a=r;var f=e.fn.ajaxGetContent.lastClickedElement;var l=f&&f.data("options")?f.data("options"):t;e.each(l.params,function(t,n){if(f.is(t))e.each(n,function(e,t){o.push({name:e,value:t})})});t.onSend(r);if(t.requestParameter)o.push({name:t.requestParameter,value:"on"});e.fn.ajaxGetContent.ajaxHandler=e.ajax({url:a,data:o,type:"GET",success:i,error:i,context:this});e.fn.ajaxGetContent.history.push(r)}else{e.fn.ajaxGetContent.ajaxHandler=null;if(r=="success"){if(t.useCache&&e.fn.ajaxGetContent.lastClickedUrl){e.fn.ajaxGetContent.cache[e.fn.ajaxGetContent.lastClickedUrl]=n}}else{}t.onReceive(n,r,s==true)}};e.fn.ajaxGetContent.load=function(t){if(e.fn.ajaxGetContent.usePushState){if(t==null)t=location.href;history.pushState({},"",t);e(window).trigger("popstate")}else{if(t==null)t=e.param.fragment();if(e.param.fragment()!=t)jQuery.bbq.pushState(t,2);else i(true,t)}};e.fn.ajaxGetContent.scrollTo=function(t,n,r){if(typeof r=="undefined")r=500;var i=e("html").scrollTop();if(!i)i=e("body").scrollTop();var s=typeof t=="number";if(n||i>(s?t:e(t).offset().top)){e("html,body").stop().animate({scrollTop:s?t:e(t).offset().top},r)}};e.fn.ajaxGetContent.getCurrentUrl=function(t,n){var r="";if(e.fn.ajaxGetContent.usePushState){r=new String(location.href);if(!t){var i=r.indexOf("//");i=i>=0?i+2:0;r=r.substr(r.indexOf("/",i));if(r.length==0)r="/"}}else r=e.param.fragment();if(!n)r=r.indexOf("#")==-1?r:r.substr(0,r.indexOf("#"));return r};e.fn.ajaxGetContent.clearCache=function(){e.fn.ajaxGetContent.cache=new Array};var s=function(){e(window).bind(e.fn.ajaxGetContent.usePushState?"popstate":"hashchange",function(n){var r=null;var s=false;if(e.fn.ajaxGetContent.usePushState){r=e.fn.ajaxGetContent.getCurrentUrl(true,true);if(e.fn.ajaxGetContent.lastFullUrl&&r.indexOf("#")>=0){s=e.fn.ajaxGetContent.getCurrentUrl(true)==e.fn.ajaxGetContent.lastFullUrl}}else{r=e.fn.ajaxGetContent.getCurrentUrl();urlCheck=r;if(urlCheck.indexOf("?")>=0)urlCheck=urlCheck.substr(0,urlCheck.indexOf("?"));s=!(urlCheck=="")&&!t.onHrefCheck(urlCheck)}if(!s)if(!(e.fn.ajaxGetContent.usePushState&&!wasLoaded))i(true,r)});e("body").data("ajaxGetContent",true)};if(!e("body").data("ajaxGetContent"))s();e(window).load(function(){wasLoaded=false;setTimeout(function(){wasLoaded=true;if(!e.fn.ajaxGetContent.usePushState&&e.param.fragment()!=""){e(window).trigger("hashchange")}if(!e.fn.ajaxGetContent.lastUrl){e.fn.ajaxGetContent.lastUrl=e.fn.ajaxGetContent.getCurrentUrl();e.fn.ajaxGetContent.lastFullUrl=e.fn.ajaxGetContent.getCurrentUrl(true)}},1)});var o=function(t){var n=location.href;if(!t&&!e.fn.ajaxGetContent.usePushState){var r=n.indexOf("#");if(r>=0){n=n.substr(r);var i=n.indexOf("?");if(i>=0)n=n.substr(0,i);t=n}}return t};if(t.formsGet!=null)e.each(t.formsGet,function(t,n){e(t).each(function(t,r){r=e(r);if(r.data("ajaxGetContent"))return true;var i=function(t,n,r){return function(){if(n&&!n.call(t))return false;if(r&&!r.call(t))return false;e.fn.ajaxGetContent.lastClickedElement=e(t);e.fn.ajaxGetContent.load(o(e(t).attr("action"))+"?"+e(t).serialize().replace("%5B%5D","[]"));return false}};var s=r.get(0).onsubmit;r.get(0).onsubmit=null;r.submit(i(this,s,n));r.data("ajaxGetContent",true)})});if(t.formsPost!=null)e.each(t.formsPost,function(t,n){e(t).each(function(t,r){r=e(r);if(r.data("ajaxGetContent"))return true;var i=function(t,n,r){return function(){if(typeof CKEDITOR!=="undefined")for(var i in CKEDITOR.instances)CKEDITOR.instances[i].updateElement();var s=e(t);if(n&&!n.call(t))return false;if(r.onSend&&!r.onSend.call(t))return false;s.find(".submit-clicked-append").remove();var u=s.find(".agc-submit-clicked");if(!u.length)u=s.find('input[type="submit"], button[type="submit"]').first();if(u.length)s.append(e('<input type="hidden" name="'+u.attr("name")+'" value="'+u.attr("value")+'" class="submit-clicked-append" style="display:none !important;" />'));e.fn.ajaxGetContent.lastClickedElement=s;var a=r.onReceive?r.onReceive:function(){};e.ajax({url:o(s.attr("action")),data:s.serializeArray(),type:"POST",success:a,error:a,context:t});return false}};var s=r.get(0).onsubmit;r.get(0).onsubmit=null;r.find('input[type="submit"], button[type="submit"]').click(function(){e(this).parents("form").find('input[type="submit"], button[type="submit"]').removeClass("agc-submit-clicked");e(this).addClass("agc-submit-clicked")});r.submit(i(r.get(0),s,n));r.data("ajaxGetContent",true)})});return this.each(function(n,r){$this=e(r);var i=$this.data("ajaxGetContent");var s=$this.attr("href");if(!s)return true;var o=new String;var u=location.href.substr(0,5)!="http:";var a=new String((u?"https://":"http://")+window.location.hostname);if(s.indexOf(a)==0)s=s.substr(a.length);if(s.indexOf("?")>=0){o=s.substr(s.indexOf("?"));s=s.substr(0,s.indexOf("?"))}var f=$this.attr("target");var l=s.indexOf("#")>=0||typeof f!=="undefined"&&f!==false;var c=t.onHrefCheck(s,o);var h=t.onElementCheck($this);var p=false;e.each(t.excludeAttr,function(e,t){if($this.attr(e)&&$this.attr(e).indexOf(t)==0){p=true;return}});var d=$this.get(0).onclick!=null;if(!i&&!l&&c&&h&&!p&&!d){$this.data("ajaxGetContent",true);$this.click(function(n){var r=e(this);if(!t.onHrefCheck(s,o))return true;if(!t.onElementCheck(r))return true;if(n&&n.which&&n.which!=1)return true;var i=new String(window.location.href);if(i.indexOf("#")>=0)i=i.substr(0,i.indexOf("#"));if(!e.fn.ajaxGetContent.usePushState){var u=t.baseUrl;if(u!=""){if(i!=u){location.href=u+"#"+s+o;return false}}}r.data("options",t);e.fn.ajaxGetContent.lastClickedElement=r;e.fn.ajaxGetContent.load(s+o);return false})}})}})(jQuery);


/*
 * jQuery BBQ: Back Button & Query Library - v1.2.1 - 2/17/2010
 * http://benalman.com/projects/jquery-bbq-plugin/
 * 
 * Copyright (c) 2010 "Cowboy" Ben Alman
 * Dual licensed under the MIT and GPL licenses.
 * http://benalman.com/about/license/
 */
(function(e,t){"$:nomunge";function N(e){return typeof e==="string"}function C(e){var t=r.call(arguments,1);return function(){return e.apply(this,t.concat(r.call(arguments)))}}function k(e){return e.replace(/^[^#]*#?(.*)$/,"$1")}function L(e){return e.replace(/(?:^[^?#]*\?([^#]*).*$)?.*/,"$1")}function A(r,o,a,f,l){var c,h,p,d,g;if(f!==n){p=a.match(r?/^([^#]*)\#?(.*)$/:/^([^#?]*)\??([^#]*)(#?.*)/);g=p[3]||"";if(l===2&&N(f)){h=f.replace(r?S:E,"")}else{d=u(p[2]);f=N(f)?u[r?m:v](f):f;h=l===2?f:l===1?e.extend({},f,d):e.extend({},d,f);h=s(h);if(r){h=h.replace(x,i)}}c=p[1]+(r?"#":h||!p[1]?"?":"")+h+g}else{c=o(a!==n?a:t[y][b])}return c}function O(e,t,r){if(t===n||typeof t==="boolean"){r=t;t=s[e?m:v]()}else{t=N(t)?t.replace(e?S:E,""):t}return u(t,r)}function M(t,r,i,o){if(!N(i)&&typeof i!=="object"){o=i;i=r;r=n}return this.each(function(){var n=e(this),u=r||h()[(this.nodeName||"").toLowerCase()]||"",a=u&&n.attr(u)||"";n.attr(u,s[t](a,i,o))})}var n,r=Array.prototype.slice,i=decodeURIComponent,s=e.param,o,u,a,f=e.bbq=e.bbq||{},l,c,h,p=e.event.special,d="hashchange",v="querystring",m="fragment",g="elemUrlAttr",y="location",b="href",w="src",E=/^.*\?|#.*$/g,S=/^.*\#/,x,T={};s[v]=C(A,0,L);s[m]=o=C(A,1,k);o.noEscape=function(t){t=t||"";var n=e.map(t.split(""),encodeURIComponent);x=new RegExp(n.join("|"),"g")};o.noEscape(",/");e.deparam=u=function(t,r){var s={},o={"true":!0,"false":!1,"null":null};e.each(t.replace(/\+/g," ").split("&"),function(t,u){var a=u.split("="),f=i(a[0]),l,c=s,h=0,p=f.split("]["),d=p.length-1;if(/\[/.test(p[0])&&/\]$/.test(p[d])){p[d]=p[d].replace(/\]$/,"");p=p.shift().split("[").concat(p);d=p.length-1}else{d=0}if(a.length===2){l=i(a[1]);if(r){l=l&&!isNaN(l)?+l:l==="undefined"?n:o[l]!==n?o[l]:l}if(d){for(;h<=d;h++){f=p[h]===""?c.length:p[h];c=c[f]=h<d?c[f]||(p[h+1]&&isNaN(p[h+1])?{}:[]):l}}else{if(e.isArray(s[f])){s[f].push(l)}else if(s[f]!==n){s[f]=[s[f],l]}else{s[f]=l}}}else if(f){s[f]=r?n:""}});return s};u[v]=C(O,0);u[m]=a=C(O,1);e[g]||(e[g]=function(t){return e.extend(T,t)})({a:b,base:b,iframe:w,img:w,input:w,form:"action",link:b,script:w});h=e[g];e.fn[v]=C(M,v);e.fn[m]=C(M,m);f.pushState=l=function(e,r){if(N(e)&&/^#/.test(e)&&r===n){r=2}var i=e!==n,s=o(t[y][b],i?e:{},i?r:2);t[y][b]=s+(/#/.test(s)?"":"#")};f.getState=c=function(e,t){return e===n||typeof e==="boolean"?a(e):a(t)[e]};f.removeState=function(t){var r={};if(t!==n){r=c();e.each(e.isArray(t)?t:arguments,function(e,t){delete r[t]})}l(r,2)};p[d]=e.extend(p[d],{add:function(t){function i(e){var t=e[m]=o();e.getState=function(e,r){return e===n||typeof e==="boolean"?u(t,e):u(t,r)[e]};r.apply(this,arguments)}var r;if(e.isFunction(t)){r=t;return i}else{r=t.handler;t.handler=i}}})})(jQuery,this);(function(e,t,n){"$:nomunge";function c(e){e=e||t[s][u];return e.replace(/^[^#]*#?(.*)$/,"$1")}var r,i=e.event.special,s="location",o="hashchange",u="href",a=document.documentMode,f=navigator.appVersion.indexOf("MSIE")!=-1&&parseFloat(navigator.appVersion.split("MSIE")[1])<8,l="on"+o in t&&!f;e[o+"Delay"]=100;i[o]=e.extend(i[o],{setup:function(){if(l){return false}e(r.start)},teardown:function(){if(l){return false}e(r.stop)}});r=function(){function h(){a=l=function(e){return e};if(f){i=e('<iframe src="javascript:0"/>').hide().insertAfter("body")[0].contentWindow;l=function(){return c(i.document[s][u])};a=function(e,t){if(e!==t){var n=i.document;n.open().close();n[s].hash="#"+e}};a(c())}}var n={},r,i,a,l;n.start=function(){if(r){return}var n=c();a||h();(function i(){var f=c(),h=l(n);if(f!==n){a(n=f,h);e(t).trigger(o)}else if(h!==n){t[s][u]=t[s][u].replace(/#.*/,"")+"#"+h}r=setTimeout(i,e[o+"Delay"])})()};n.stop=function(){if(!i){r&&clearTimeout(r);r=0}};return n}()})(jQuery,this)
