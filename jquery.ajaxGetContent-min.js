/*	

 *	jQuery AjaxGetContent 1.3.3


 *
 *
 *	Requires: jQuery BBQ, http://benalman.com/projects/jquery-bbq-plugin/
 *	
 *	More info at:
 *	www.implico.pl/lang-en/ajaxgetcontent-dynamic-ajax-website,7.html
 *	info@implico.pl
 *	
 *	Copyright (c) 2012 Implico Group
 *	www.implico.pl
 *
 *	Licensed under the MIT license.
 *	http://en.wikipedia.org/wiki/MIT_License
 */


(function(e){e.fn.ajaxGetContent=function(t){t=e.extend({requestParameter:"ajax_get_standard_content",baseUrl:"",useCache:true,forceBookmarkLinking:false,params:{},excludeAttr:{rel:"lightbox",rel:"nofollow"},onHrefCheck:function(e,t){return e.length>0&&(e.substr(e.length-1,1)=="/"||e.substr(e.length-5,5)==".html"||e.substr(e.length-4,4)==".php")},onElementCheck:function(e){return!e.hasClass("no-ajax-load")&&e.attr("rel")!="nofollow"},onSend:function(e){},onReceive:function(e,t){}},t);if(!e("body").data("ajaxGetContent")){var n=navigator.userAgent.toLowerCase().indexOf("android")>-1;e.fn.ajaxGetContent.usePushState=Boolean(!t.forceBookmarkLinking&&history.pushState&&!n)}if(!e("body").data("ajaxGetContent"))e.fn.ajaxGetContent.cache=new Array;var r=this;e.fn.ajaxGetContent.lastClickedElement=null;e.fn.ajaxGetContent.lastClickedUrl=null;e.fn.ajaxGetContent.ajaxHandler=null;wasLoaded=true;var i=function(n,r){if(typeof n=="boolean"){if(e.fn.ajaxGetContent.ajaxHandler){e.fn.ajaxGetContent.ajaxHandler.abort();e.fn.ajaxGetContent.ajaxHandler=null}e.fn.ajaxGetContent.lastClickedUrl=r;e.fn.ajaxGetContent.lastUrl=e.fn.ajaxGetContent.getCurrentUrl();e.fn.ajaxGetContent.lastFullUrl=e.fn.ajaxGetContent.getCurrentUrl(true);if(t.useCache&&r in e.fn.ajaxGetContent.cache){t.onSend(r);i(e.fn.ajaxGetContent.cache[r],"success");return}var s=new Array;var o=new String;if(r.indexOf("?")>=0)o=r.substr(r.indexOf("?"));var u=e.deparam(o);e.each(u,function(e,t){s.push({name:e,value:t})});var a=e.fn.ajaxGetContent.lastClickedElement;var f=a&&a.data("options")?a.data("options"):t;e.each(f.params,function(t,n){if(a.is(t))e.each(n,function(e,t){s.push({name:e,value:t})})});t.onSend(r);s.push({name:t.requestParameter,value:"on"});e.fn.ajaxGetContent.ajaxHandler=e.ajax({url:r,data:s,type:"GET",success:i,error:i,context:this})}else{e.fn.ajaxGetContent.ajaxHandler=null;if(r=="success"){if(t.useCache&&e.fn.ajaxGetContent.lastClickedUrl){e.fn.ajaxGetContent.cache[e.fn.ajaxGetContent.lastClickedUrl]=n}}else{}t.onReceive(n,r)}};e.fn.ajaxGetContent.load=function(t){if(e.fn.ajaxGetContent.usePushState){if(t==null)t=location.href;history.pushState({},"",t);e(window).trigger("popstate")}else{if(t==null)t=e.param.fragment();if(e.param.fragment()!=t)jQuery.bbq.pushState(t,2);else i(true,t)}};e.fn.ajaxGetContent.scrollTo=function(t,n){var r=e("html").scrollTop();if(!r)r=e("body").scrollTop();if(n||r>e(t).offset().top){e("html,body").animate({scrollTop:e(t).offset().top},500)}};e.fn.ajaxGetContent.getCurrentUrl=function(t){var n="";if(e.fn.ajaxGetContent.usePushState){n=new String(location.href);if(!t){var r=n.indexOf("//");r=r>=0?r+2:0;n=n.substr(n.indexOf("/",r));if(n.length==0)n="/"}}else n=e.param.fragment();n=n.indexOf("#")==-1?n:n.substr(0,n.indexOf("#"));return n};e.fn.ajaxGetContent.clearCache=function(){e.fn.ajaxGetContent.cache=new Array};var s=function(){e(window).bind(e.fn.ajaxGetContent.usePushState?"popstate":"hashchange",function(n){var r=null;var s=false;if(e.fn.ajaxGetContent.usePushState){r=e.fn.ajaxGetContent.getCurrentUrl(true);if(e.fn.ajaxGetContent.lastFullUrl){var o=r.indexOf("#")==-1?r:r.substr(0,r.indexOf("#"));s=o.substr(0)==e.fn.ajaxGetContent.lastFullUrl.substr(0)}}else{r=e.fn.ajaxGetContent.getCurrentUrl();if(r.indexOf("?")>=0)r=r.substr(0,r.indexOf("?"));s=!(r=="")&&!t.onHrefCheck(r)}if(!s)if(!(e.fn.ajaxGetContent.usePushState&&!wasLoaded))i(true,r)});e("body").data("ajaxGetContent",true)};if(!e("body").data("ajaxGetContent"))s();e(window).load(function(){wasLoaded=false;setTimeout(function(){wasLoaded=true;if(!e.fn.ajaxGetContent.usePushState&&e.param.fragment()!=""){e(window).trigger("hashchange")}e.fn.ajaxGetContent.lastUrl=e.fn.ajaxGetContent.getCurrentUrl();e.fn.ajaxGetContent.lastFullUrl=e.fn.ajaxGetContent.getCurrentUrl(true)},1)});return this.each(function(n,r){$this=e(r);var i=$this.data("ajaxGetContent");var s=$this.attr("href");if(!s)return true;var o=new String;var u=location.href.substr(0,5)!="http:";var a=new String((u?"https://":"http://")+window.location.hostname);if(s.indexOf(a)==0)s=s.substr(a.length);if(s.indexOf("?")>=0){o=s.substr(s.indexOf("?"));s=s.substr(0,s.indexOf("?"))}var f=$this.attr("target");var l=s.indexOf("#")>=0||typeof f!=="undefined"&&f!==false;var c=t.onHrefCheck(s,o);var h=t.onElementCheck($this);var p=false;e.each(t.excludeAttr,function(e,t){if($this.attr(e)&&$this.attr(e).indexOf(t)==0){p=true;return}});var d=$this.get(0).onclick!=null;if(!i&&!l&&c&&h&&!p&&!d){$this.data("ajaxGetContent",true);$this.click(function(n){if(n&&n.which&&n.which!=1)return true;if(e.fn.ajaxGetContent.lastUrl==s+o)return false;var r=new String(window.location.href);if(r.indexOf("#")>=0)r=r.substr(0,r.indexOf("#"));if(!e.fn.ajaxGetContent.usePushState){var i=t.baseUrl;if(i!=""){if(r!=i){location.href=i+"#"+s+o;return false}}}var u=e(this);u.data("options",t);e.fn.ajaxGetContent.lastClickedElement=u;if(e.fn.ajaxGetContent.usePushState){history.pushState({},"",s+o);e(window).trigger("popstate")}else jQuery.bbq.pushState(s+o,2);return false})}})}})(jQuery)